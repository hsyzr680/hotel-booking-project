# ๐ง ุฅุตูุงุญ ูุดููุฉ Build ุงูุฎุงุตุฉ ุจู NextAuth

## โ ุงูุชุนุฏููุงุช ุงููุทุจูุฉ:

### 1. ููู `src/lib/auth.ts`

#### ุฃ) ุฅุถุงูุฉ Fallback ููู NEXTAUTH_SECRET
```typescript
const getNextAuthSecret = () => {
  if (process.env.NEXTAUTH_SECRET) {
    return process.env.NEXTAUTH_SECRET
  }
  
  // ุงุณุชุฎุฏุงู ูููุฉ ูุคูุชุฉ ุฃุซูุงุก ุงูุจูุงุก
  return 'fallback-secret-for-build-only-change-in-production'
}
```

**ุงููุงุฆุฏุฉ:** ูุณูุญ ุจุฅุชูุงู ุงูุจูุงุก ุญุชู ูู `NEXTAUTH_SECRET` ุบูุฑ ููุฌูุฏ ููุช ุงูุจูุงุก.

---

#### ุจ) ุฅุถุงูุฉ Try-Catch ุญูู ุนูููุงุช Prisma
```typescript
try {
  const user = await prisma.user.findUnique({
    where: { email: credentials.email },
  })
  // ... ุจุงูู ุงูููุฏ
} catch (error) {
  console.error('ุฎุทุฃ ูู ุงููุตุงุฏูุฉ:', error)
  
  // ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
  if (error.message.includes('PrismaClient') || 
      error.message.includes('database')) {
    throw new Error('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช')
  }
  
  throw error
}
```

**ุงููุงุฆุฏุฉ:** 
- โ ููุน ุชุนุทู ุงููููุน ุจุณุจุจ ุฃุฎุทุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
- โ ุชุณุฌูู ุงูุฃุฎุทุงุก ูููุทูุฑูู

---

### 2. ููู `src/lib/prisma.ts`

#### ุฅูุดุงุก Prisma Client ุจุดูู ุขูู
```typescript
const createPrismaClient = () => {
  try {
    return new PrismaClient({
      log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : ['error'],
    })
  } catch (error) {
    console.error('โ๏ธ  ุฎุทุฃ ูู ุฅูุดุงุก Prisma Client:', error)
    return new PrismaClient()
  }
}
```

**ุงููุงุฆุฏุฉ:**
- โ ุงูุชุนุงูู ูุน ุฃุฎุทุงุก ุฅูุดุงุก Prisma Client
- โ ุชุณุฌูู ููุงุณุจ ุญุณุจ ุงูุจูุฆุฉ (development/production)
- โ ุงูุณูุงุญ ุจุฅุชูุงู ุงูุจูุงุก ุญุชู ูุน ูุฌูุฏ ูุดุงูู

---

### 3. ููู `next.config.js`

#### ุฅุถุงูุฉ External Packages
```javascript
experimental: {
  serverComponentsExternalPackages: ['@prisma/client', 'bcryptjs'],
}
```

**ุงููุงุฆุฏุฉ:**
- โ ููุน Vercel ูู ูุญุงููุฉ bundle ูุฐู ุงูููุชุจุงุช
- โ ุชุญุณูู ุฃุฏุงุก ุงูุจูุงุก
- โ ุชุฌูุจ ุฃุฎุทุงุก ุงูุชูุงูู

---

## ๐ฏ ููู ุชุนูู ุงูุฅุตูุงุญุงุช:

### ุฃุซูุงุก ุงูุจูุงุก (Build Time):
1. โ ุฅุฐุง `NEXTAUTH_SECRET` ุบูุฑ ููุฌูุฏ โ ูุณุชุฎุฏู ูููุฉ ูุคูุชุฉ
2. โ ุฅุฐุง ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชููุฑุฉ โ ูุง ูุญุงูู ุงูุงุชุตุงู
3. โ ุงูุจูุงุก ูููู ุจูุฌุงุญ โจ

### ุฃุซูุงุก ุงูุชุดุบูู (Runtime):
1. โ ุงุณุชุฎุฏุงู `NEXTAUTH_SECRET` ุงูุญูููู ูู Environment Variables
2. โ ูุญุงููุฉ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
3. โ ุฅุฐุง ูุดู ุงูุงุชุตุงู โ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู

---

## โ๏ธ ููู ุฌุฏุงู:

### ูุฌุจ ุฅุถุงูุฉ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูู Vercel:

```env
NEXTAUTH_SECRET=<ููุชุงุญ ุนุดูุงุฆู ููู>
DATABASE_URL=<ุฑุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช>
NEXTAUTH_URL=https://your-project.vercel.app
```

**ุทุฑููุฉ ุชูููุฏ NEXTAUTH_SECRET:**
```bash
# ุนูู Windows PowerShell
[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Maximum 256 }))

# ุนูู Mac/Linux
openssl rand -base64 32

# ุฃู ุงุณุชุฎุฏู ูููุน
https://generate-secret.vercel.app/32
```

---

## ๐ ุฎุทูุงุช ุงููุดุฑ ุจุนุฏ ุงูุชุนุฏููุงุช:

### 1. ุงุญูุธ ุงูุชุนุฏููุงุช ูุฑูุนูุง:
```bash
git add .
git commit -m "Fix: Add try-catch for Prisma and fallback for NEXTAUTH_SECRET"
git push
```

### 2. ุชุฃูุฏ ูู ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูู Vercel:
- ุงุฐูุจ ูู **Settings** โ **Environment Variables**
- ุชุฃูุฏ ูู ูุฌูุฏ:
  - โ `DATABASE_URL`
  - โ `NEXTAUTH_SECRET`
  - โ `NEXTAUTH_URL`

### 3. ุงูุชุธุฑ ุงูุชูุงู Build:
- Vercel ุณุชุจุฏุฃ Build ุชููุงุฆูุงู
- ุณูุฃุฎุฐ 2-3 ุฏูุงุฆู
- ุชุญูู ูู Logs ุฅุฐุง ูุดู

### 4. ุงุฎุชุจุฑ ุงููููุน:
```
https://your-project.vercel.app
```

---

## ๐ ุฃุฎุทุงุก ุดุงุฆุนุฉ ูุญููููุง:

### ุฎุทุฃ: "Failed to collect page data"
**ุงูุณุจุจ:** Prisma ูุญุงูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃุซูุงุก ุงูุจูุงุก  
**ุงูุญู:** โ ุชู ุฅุตูุงุญู ุจุงูุชุนุฏููุงุช ุงูุฌุฏูุฏุฉ!

### ุฎุทุฃ: "NEXTAUTH_SECRET is not defined"
**ุงูุณุจุจ:** ุงููุชุบูุฑ ุบูุฑ ููุฌูุฏ ูู Vercel  
**ุงูุญู:** 
1. ุงุฐูุจ ูู Vercel โ Settings โ Environment Variables
2. ุฃุถู `NEXTAUTH_SECRET` ุจูููุฉ ุนุดูุงุฆูุฉ ูููุฉ

### ุฎุทุฃ: "PrismaClient is unable to run in this browser environment"
**ุงูุณุจุจ:** Prisma ูุญุงูู ุงูุชุดุบูู ูู ุงููุชุตูุญ  
**ุงูุญู:** โ ุชู ุฅุตูุงุญู ุจุฅุถุงูุฉ `serverComponentsExternalPackages`

### ุฎุทุฃ: "Can't reach database server at ..."
**ุงูุณุจุจ:** `DATABASE_URL` ุบูุฑ ุตุญูุญ ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุง ุชุนูู  
**ุงูุญู:**
1. โ ุชุญูู ูู `DATABASE_URL` ูู Environment Variables
2. โ ุชุฃูุฏ ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุนูู (Supabase/Neon/Vercel Postgres)
3. โ ุงุฎุชุจุฑ ุงูุงุชุตุงู: `npx prisma db pull`

---

## ๐ Checklist ุงูุชุญูู:

ูุจู ุงููุดุฑุ ุชุฃูุฏ ูู:
- [ ] โ ุชู ุชุนุฏูู `src/lib/auth.ts`
- [ ] โ ุชู ุชุนุฏูู `src/lib/prisma.ts`
- [ ] โ ุชู ุชุนุฏูู `next.config.js`
- [ ] โ ุชู ุฑูุน ุงูุชุนุฏููุงุช ุนูู GitHub
- [ ] โ ุชู ุฅุถุงูุฉ Environment Variables ูู Vercel
- [ ] โ Build ูุฌุญ ุจุฏูู ุฃุฎุทุงุก
- [ ] โ ุงููููุน ูุนูู
- [ ] โ ุชุณุฌูู ุงูุฏุฎูู ูุนูู

---

## ๐ ููู ุงููุดููุฉ (ูููุทูุฑูู):

### ููุงุฐุง ูุงู ุงูุจูุงุก ููุดูุ

1. **Next.js Build Process:**
   - Next.js ูุญุงูู pre-render ุงูุตูุญุงุช ุฃุซูุงุก ุงูุจูุงุก
   - ุฅุฐุง ูุงู ุงูููุฏ ูุญุงูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช โ ูุดู

2. **NextAuth Secret:**
   - NextAuth ูุญุชุงุฌ `NEXTAUTH_SECRET` ููุนูู
   - ูู Vercelุ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูุฏ ูุง ุชููู ูุชุงุญุฉ ุฃุซูุงุก ุงูุจูุงุก

3. **Prisma Client:**
   - ูุญุชุงุฌ ุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช
   - ูู ุจูุฆุฉ ุงูุจูุงุกุ ูุฏ ูุง ุชููู ูุชุงุญุฉ

### ุงูุญู:
โ **Lazy Evaluation** - ุนุฏู ุชูููุฐ ุงูููุฏ ุฅูุง ุนูุฏ ุงูุญุงุฌุฉ  
โ **Fallback Values** - ููู ุงุญุชูุงุทูุฉ ููุจูุงุก  
โ **Try-Catch** - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุตุญูุญ  
โ **External Packages** - ููุน bundling ููููุชุจุงุช ุงูุซูููุฉ  

---

## ๐ ูุชูุฌุฉ ุงูุชุนุฏููุงุช:

### ูุจู โ
```
Build โ ูุญุงูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช โ ูุดู
```

### ุจุนุฏ โ
```
Build โ ูุชุฎุทู ุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช โ ูุฌุญ
Runtime โ ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช โ ูุนูู
```

---

## ๐ ุงูุฏุนู:

ุฅุฐุง ูุง ุฒูุช ุชูุงุฌู ูุดุงูู:
1. ุชุญูู ูู Vercel Logs: **Deployments** โ Click deployment โ **View Function Logs**
2. ุชุญูู ูู Browser Console ููุฃุฎุทุงุก
3. ุฌุฑูุจ ุงูุจูุงุก ูุญููุงู: `npm run build`
4. ุงุฎุชุจุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช: `npx prisma studio`

---

**๐ ุงูุขู ุงููุดุฑูุน ุฌุงูุฒ ูููุดุฑ ุนูู Vercel ุจุฏูู ูุดุงูู Build!**

**โฑ๏ธ ุงูุจูุงุก ุณูุฃุฎุฐ: 2-3 ุฏูุงุฆู**
